<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</title>
<link rel="stylesheet" href="../Css/style.css">
<style>
    .countdown.red {
        color: red;
        font-weight: bold;
    }
</style>
</head>
<body>
<h2 style="text-align:center;">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° </h2>
<table>
<thead><tr><th>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</th><th>‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</th><th>‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤</th></tr></thead>
<tbody id="list"></tbody>
</table>

<script>
const events  = {
    "Wartime": ["08:00","10:00","15:00","19:00","22:00","01:00","03:00"],
    "Airdrop": ["12:50","16:50","19:50","22:50"],
    "‡∏¢‡∏∂‡∏î‡∏à‡∏∏‡∏î (Capture the Flags)": ["12:00","14:00","16:00","21:00"],
    "‡∏õ‡∏•‡πâ‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ (Rob bank)": ["14:30","20:30","02:00"],
    "Lootbox": ["15:30","19:30","21:30","00:30"],
    "‡∏ä‡∏¥‡∏á‡∏î‡∏≤‡∏ö": ["09:00","22:30","01:40"]
};
function nextTime(t){
    let now=new Date(),[h,m]=t.split(":").map(Number);
    let e=new Date(now.getFullYear(),now.getMonth(),now.getDate(),h,m);
    if(e<=now) e.setDate(e.getDate()+1);
    return e;
}

function render(){
    let tb=document.getElementById("list"); 
    tb.innerHTML="";
    for(let [name,times] of Object.entries(events)){
        let soonest=times.map(nextTime).sort((a,b)=>a-b)[0];
        let diff=soonest-new Date();
        let totalSeconds=Math.floor(diff/1000);

        let h=Math.floor(totalSeconds/3600);
        let m=Math.floor((totalSeconds%3600)/60);
        let s=totalSeconds%60;

        tb.innerHTML+=`<tr>
            <td>${name}</td>
            <td>${soonest.toLocaleTimeString()}</td>
            <td class="countdown" data-time="${totalSeconds}">
                ${h} ‡∏ä‡∏°. ${m} ‡∏ô‡∏≤‡∏ó‡∏µ ${s} ‡∏ß‡∏¥
            </td>
        </tr>`;
    }
}

function startCountdown() {
    setInterval(() => {
        document.querySelectorAll('.countdown').forEach(el => {
            let timeLeft = parseInt(el.getAttribute('data-time'), 10);
            if (timeLeft > 0) {
                timeLeft--;
                el.setAttribute('data-time', timeLeft);

                let h = Math.floor(timeLeft / 3600);
                let m = Math.floor((timeLeft % 3600) / 60);
                let s = timeLeft % 60;

                el.innerHTML = `${h} ‡∏ä‡∏°. ${m} ‡∏ô‡∏≤‡∏ó‡∏µ ${s} ‡∏ß‡∏¥`;

                if (timeLeft <= 300) { 
                    el.classList.add('red');
                    if (!el.querySelector('.bell')) {
                        el.innerHTML += ' <span class="bell">üîî</span>';
                        playBell();
                    }
                }
            } else {
                el.textContent = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß";
            }
        });
    }, 1000);
}

function playBell(){
    const audio = new Audio("https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg");
    audio.volume = 0.3;
    audio.play();
}

render();
startCountdown();

</script>
</body>
</html>
